@model RedTeam.Models.CarSimulator


@{
    ViewBag.Title = "Car Simulator";

    <script src="../Scripts/RGraph.common.core.js"></script>
    <script src="../Scripts/RGraph.fuel.js"></script>
}

<h2>Car Simulator</h2>

<div class="">
    <div>
        <h2 class="h5">Door Lock</h2>
        <img src="~/Images/key_car_lock_pic.png" height="57" width="57"><input type="checkbox" checked="@Model.doorLock" id="doorlock"  />
    </div>
    <div>
        <h2 class="h5">Head Lights</h2>
        <img src="~/Images/headlightIcon.jpg" height="55" width="55"><input type="checkbox" checked="@Model.carLight" id="carlight" />
    </div>
    <div>
        <h2 class="h5">Start Engine</h2>
        <img src="~/Images/engineStartIcon.jpg" height="88" width="88"><input type="checkbox" checked="@Model.carEngine" id="carengine" /><audio id="EngineSound" src="~/Sounds/vehicle089.wav" preload="none" autoplay="@Model.carEngine"></audio>
    </div>
</div>


@section scripts {
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            var currentSpeed = 0;
            var amountOfGas = 20;
            var gasTimer;
            var speedTimer;
            //var  timer = setInterval(function () {                       
            //    amountOfGas = amountOfGas - 1;
            //    if (amountOfGas === 0) {
            //        clearInterval(timer);
            //    }
            //    carSimulator.server.sendGas(amountOfGas);
            //}, 1000);

            var carSimulator = $.connection.carSimulatorHub;
            


            // Reference the auto-generated proxy for the hub.
            carSimulator.client.doorLock = function (locked) {  // Create a function that the hub can call back to display messages.
                $("#doorlock").prop('checked', locked);
            };
            carSimulator.client.carLights = function (off) {
                $("#carlight").prop('checked', off);
            };

            carSimulator.client.carEngine = function (off) {
                $("#carengine").prop('checked', off);
                if (off) {
                    //$("#EngineSound").prop('autoplay', true)
                    gasTimer = setInterval(function () {
                        amountOfGas = amountOfGas - 1;
                        if (amountOfGas === 0) {
                            clearInterval(gasTimer);
                        }
                        carSimulator.server.sendGas(amountOfGas);
                    }, 1000);

                    speedTimer = setInterval(function () {
                        currentSpeed = currentSpeed + 1;
                        if (currentSpeed === 90) {
                            clearInterval(speedTimer)
                        }
                        carSimulator.server.sendSpeed(currentSpeed);
                    }, 1000);
                } 
                else {
                    $("#carengine").prop('checked', false);
                    clearInterval(gasTimer);
                    clearInterval(speedTimer);
                    carSimulator.server.sendSpeed(0);

                }
            };

            $.connection.hub.start().done(function () {

                    });
                });
            

  </script>
}



